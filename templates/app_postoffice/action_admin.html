<h3>Почта Росссии - Отслеживание посылок</h3>
<div class="well">
   <ul class="nav nav-tabs">
      <li class="active"><a href="#check" data-toggle="tab">Проверка почты</a></li>
      <li><a href="#proxy" data-toggle="tab">Настройка прокси</a></li>
      <li><a href="#email" data-toggle="tab">Настройка уведомлений</a></li>
   </ul>
   <div id="myTabContent" class="tab-content">
      <div class="tab-pane active in" id="check">
         <div class="control-group">
            <form  class="form-inline" action="admin.php" method="post" enctype="multipart/form-data" id="TrackAddForm">
               <input  name="trackid" type="text" class="span3" placeholder="Номер трека" />
               <input  name="trackname" type="text" class="span3" placeholder="Название трека" />
               <input type="hidden" name="act" value="add" />
               <input type="hidden" name="pd" value="" />
               <input type="hidden" name="md" value="panel" />
               <input type="hidden" name="inst" value="" />
               <input type="hidden" name="action" value="app_postoffice" />
               <button type="submit" name="postAdd" class="btn btn-primary input-medium">Добавить</button>
            </form>
            <a href="#" role="button" class="btn btn-primary track-check">Проверить</a>
         </div>

         <div class="well">
            <table class="table table-striped table-condensed">
               <thead>
                  <tr>
                     <th>№</th>
                     <th>Трек номер</th>
                     <th>Название</th>
                     <th>Дата</th>
                     <th>Состояние</th>
                     <th>Текущее местонахождение</th>
                     <th>Статус</th>
                  </tr>
               </thead>
               <tbody>
                  [#begin TRACK_LIST#]
                  <tr>
                     <td><#TRACK_LIST.TRACK_NUM#></td>
                     <td><#TRACK_LIST.TRACK_ID#></td>
                     <td><#TRACK_LIST.TRACK_NAME#></td>
                     <td><#TRACK_LIST.OPER_DATE#></td>
                     <td><#TRACK_LIST.OPER_NAME#>: <#TRACK_LIST.ATTRIB_NAME#></td>
                     <td><#TRACK_LIST.OPER_POSTPLACE#></td>
                     [#if $T.FLAG_CHECK=="Y"#]
                     <td><span class="label label-success">Active</span></td>
                     [#else#]
                     <td><span class="label">Inactive</span></td>
                     [#endif#]
                     <td>
                        <a href="#" role="button" class="track-change-status"  data-track="<#TRACK_LIST.TRACK_ID#>"><i class="icon-pencil"></i></a>
                        <a href="#PostOfficeTrackRemoveModal" role="button" class="confirm-track-delete" data-track="<#TRACK_LIST.TRACK_ID#>" data-toggle="modal"><i class="icon-remove"></i></a>
                     </td>
                  </tr>
                  [#end TRACK_LIST#]
               </tbody>
            </table>
         </div>
      </div>
      <div class="tab-pane fade" id="proxy">
         <form  class="form-inline" action="admin.php" method="post" enctype="multipart/form-data" id="ProxySettings">
            [#begin PROXY_LIST#]
            <div class="control-group">
               <label class="checkbox">
                  [#if $T.FLAG_PROXY=="Y"#]
                     <input  name="proxy_flag" type="checkbox" value="on" checked />Использовать прокси
                  [#else#]
                     <input  name="proxy_flag" type="checkbox" value="on" />Использовать прокси
                  [#endif#]
                  <input type="hidden" name="curr_flag" value="<#PROXY_LIST.FLAG_PROXY#>" />
               </label>
            </div>
            <div class="control-group">
               <input  name="proxy_host" type="text" class="span3" value="<#PROXY_LIST.PROXY_HOST#>" placeholder="Адрес прокси" />
            </div>
            <div class="control-group">
               <input  name="proxy_port" type="text" class="span3" value="<#PROXY_LIST.PROXY_PORT#>" placeholder="Порт" />
            </div>
            <div class="control-group">
               <input  name="proxy_user" type="text" class="span3" value="<#PROXY_LIST.PROXY_USER#>" placeholder="Логин" />
            </div>
            <div class="control-group">
               <input  name="proxy_passwd" type="text" class="span3" value="<#PROXY_LIST.PROXY_PASSWD#>" placeholder="Пароль" />
            </div>
            [#end PROXY_LIST#]
            <div class="control-group">
               <input type="hidden" name="act" value="proxy" />
               <input type="hidden" name="pd" value="" />
               <input type="hidden" name="md" value="panel" />
               <input type="hidden" name="inst" value="" />
               <input type="hidden" name="action" value="app_postoffice" />
               <button type="submit" name="proxyAdd" class="btn btn-primary input-medium">Изменить</button>
            </div>
         </form>
      </div>
      <div class="tab-pane fade" id="email">
         <form  class="form-inline" action="admin.php" method="post" enctype="multipart/form-data" id="EmailSettings">
            [#begin NOTIFY_LIST#]
            <div class="control-group">
               <label class="checkbox">
                  [#if $T.FLAG_SEND=="Y"#]
                     <input  name="notify_flag" type="checkbox" value="on" checked />Оповещать о доставке посылки по email
                  [#else#]
                     <input  name="notify_flag" type="checkbox" value="on" />Оповещать о доставке посылки по email
                  [#endif#]
                  <input type="hidden" name="curr_notify_flag" value="<#NOTIFY_LIST.FLAG_SEND#>" />
               </label>
            </div>
            <div class="control-group">
               <input  name="notify_email" type="text" class="span6" value="<#NOTIFY_LIST.NOTIFY_EMAIL#>" placeholder="Адрес для отправки уведомления" />
            </div>
            <div class="control-group">
               <input  name="notify_subj" type="text" class="span6" value="<#NOTIFY_LIST.NOTIFY_SUBJ#>" placeholder="Тема сообщения" />
            </div>
            [#end NOTIFY_LIST#]
            <div class="control-group">
               <input type="hidden" name="act" value="notify" />
               <input type="hidden" name="pd" value="" />
               <input type="hidden" name="md" value="panel" />
               <input type="hidden" name="inst" value="" />
               <input type="hidden" name="action" value="app_postoffice" />
               <button type="submit" name="botifyEmail" class="btn btn-primary input-medium">Изменить</button>
            </div>
         </form>
      </div>
   </div>
</div>

<div class="modal small hide fade" id="PostOfficeTrackRemoveModal" tabindex="-1" role="dialog" aria-labelledby="PostOfficeTrackRemoveModalLabel" aria-hidden="true">
   <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      <h3 id="PostOfficeTrackRemoveModalLabel">Подтверждение удаления трек номера</h3>
   </div>
   <div class="modal-body">
      <p class="error-text">Вы уверены в том, что хотите удалить данный трек и всю информацию о нём?</p>
   </div>
   <div class="modal-footer">
      <button class="btn" data-dismiss="modal" aria-hidden="true">Отменить</button>
      <button class="btn btn-danger"  data-dismiss="modal">Удалить</button>
   </div>
</div>

<script type="text/javascript">
   $('.confirm-track-delete').on('click', function (e)
   {
      e.preventDefault();
      var track_id = $(this).data('track');
      modal = $('#PostOfficeTrackRemoveModal');

      modal.find('.btn-danger').click(function ()
      {
         var url = "admin.php?pd=&md=panel&inst=&action=app_postoffice&act=del&trackid=" + track_id;
         $.get(url).success(function (data)
         {
            alert(data);
            window.location.reload("?");
         });
      });
   });

   $('.track-check').on('click', function (e)
   {
      e.preventDefault();
      var url = "admin.php?pd=&md=panel&inst=&action=app_postoffice";
      $.get(url + "&act=check").done(function (data)
      {
         alert(data);
         window.location.reload(url);
      });
   });

   $('.track-change-status').on('click', function (e)
   {
      e.preventDefault();
      var track_id = $(this).data('track');
      var url = "admin.php?pd=&md=panel&inst=&action=app_postoffice&act=changestatus&trackid=" + track_id;
      $.get(url).done(function (data)
      {
         window.location.reload("admin.php?pd=&md=panel&inst=&action=app_postoffice");
      });
   });
</script>